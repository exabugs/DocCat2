Return-Path: <exabugs@gmail.com>
Received: by mdi.securemx.jp (mx-mdi1503) id s3D2skkI028717; Sun, 13 Apr 2014 11:54:46 +0900
Authentication-Results: mx.securemx.jp; spf=pass smtp.mailfrom=exabugs@gmail.com; dkim=pass
	 header.i=@gmail.com; dkim-adsp=pass header.From=exabugs@gmail.com
Received: from mail-pa0-f48.google.com (mail-pa0-f48.google.com [209.85.220.48])
	by mx.securemx.jp (mx-mi1500) id s3D2siTq012625
	(version=TLSv1/SSLv3 cipher=RC4-SHA bits=128 verify=NOT);
	Sun, 13 Apr 2014 11:54:45 +0900
Received: by mail-pa0-f48.google.com with SMTP id hz1so6905442pad.21
        for <sakurai@dreamarts.co.jp>; Sat, 12 Apr 2014 19:54:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=from:content-type:subject:message-id:date:to:mime-version;
        bh=XbmtZee/X0IWNLnHOOQd+59zzKPjQYHzq4v7QoWOkI8=;
        b=SWOCXrXzByEU7bkxWBCzaM+3J4wltYf3eOLbTj5ul2qhyCupL7HTyZuf6sAjM4GWE3
         hDTFY9D5Vyd7U2R9mgAFyGgkJdxfyRtCoFAGMowPqaNNtbdQ3jtq42TO5fzqBD6i3L2E
         f9j7A35Ip/tABY9nigMXF7DRF0dO/q6dHsgp/dGPOHzm6kRnNNgsbkeuroiyI0CW44eC
         cGuWV7i5D8lUrH222mijFhZ943wEXC6xYPUtoQ+3H7MLInwhRkO+HIA7lcRK7uSe667T
         BZtxx0QQmkRGTKjZJdphQFBa50fZAAI9b8yu9v2j7Xe3OOAsoKKKZGge6oF1NmjN4AG8
         JJpQ==
X-Received: by 10.68.233.200 with SMTP id ty8mr36066981pbc.1.1397357683575;
        Sat, 12 Apr 2014 19:54:43 -0700 (PDT)
Received: from ?IPv6:2407:c800:32f0:a::6:87eb? ([2407:c800:32f0:a::6:87eb])
        by mx.google.com with ESMTPSA id ry10sm5752335pab.38.2014.04.12.19.54.41
        for <multiple recipients>
        (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
        Sat, 12 Apr 2014 19:54:42 -0700 (PDT)
From: =?utf-8?B?5qu75LqV6IKH?= <exabugs@gmail.com>
Content-Type: multipart/mixed; boundary="Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622"
Subject: =?utf-8?B?5re75LuY77yT5YCL?=
Message-Id: <44B7730E-D36F-4BE0-B527-F71414A21247@gmail.com>
Date: Sun, 13 Apr 2014 11:54:39 +0900
To: =?utf-8?B?5qu75LqV6IKH?= <exabugs@gmail.com>,
        =?utf-8?B?5qu75LqV6IKH?= <sakurai@dreamarts.co.jp>
Mime-Version: 1.0 (Mac OS X Mail 7.2 \(1874\))
X-Mailer: Apple Mail (2.1874)
X-Spam: [F=0.5000000000; STSI=0.500(0); STSM=0.500(0); CM=0.500; MH=0.500(2014041215); spf=0.500; SC=none]
X-AnalysisOut: [v=2.0 cv=NcBRIR/4 c=1 sm=1 a=YVNmusk7ECEA:10 a=nDghuxUhq_w]
X-AnalysisOut: [A:10 a=jPJDawAOAc8A:10 a=BLceEmwcHowA:10 a=xqWC_Br6kY4A:10]
X-AnalysisOut: [ a=4_-BN3WEXhEA:10 a=pGLkceISAAAA:8 a=2j9I0AO2ND8A:10 a=kb]
X-AnalysisOut: [uWXffLy8HO_gAC-lIA:9 a=QEXdDO2ut3YA:10 a=zsklmW55SWEA:10 a]
X-AnalysisOut: [=GUhuF5I7AAAA:8 a=2Is7NchCAAAA:8 a=bq0agiRfCtHkXQPdiuMA:9 ]
X-AnalysisOut: [a=huXBno8TZJEA:10 a=v0td1jPWxtAA:10 a=FKK6dm4SRMT4t7a0EUYA]
X-AnalysisOut: [:9 a=t8910EfmAAAA:8 a=0UPO8d1sAAAA:8 a=8xbS1LkFZ33KVOZA3N4]
X-AnalysisOut: [A:9 a=D-7sppor8bY648h0:21 a=fwIat5CG_AjXIBOs:21]


--Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622
Content-Transfer-Encoding: base64
Content-Type: text/plain;
	charset=utf-8

5re75LuY77yT5YCL44Gn44GZDQoNCg==

--Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622
Content-Disposition: attachment;
	filename*=utf-8''MeCab%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6
Content-Type: application/octet-stream;
	x-mac-type=54455854;
	x-mac-creator=4D4D4B45;
	x-unix-mode=0644;
	name="=?utf-8?Q?MeCab=E3=81=AB=E3=81=A4=E3=81=84=E3=81=A6?="
Content-Transfer-Encoding: quoted-printable

=0AMeCab=E3=81=AEsrpm=E3=81=AF=E3=80=81=E4=BB=A5=E4=B8=8B=E3=81=8B=E3=82=89=
=E6=8B=9D=E5=80=9F=0Ahttp://packages.groonga.org/centos/6/source/SRPMS/=0A=
=0Amecab-devel=0A=
http://packages.groonga.org/centos/6/x86_64/Packages/mecab-devel-0.996-1.e=
l6.x86_64.rpm=0A=0A=0A=
http://packages.groonga.org/centos/6/source/SRPMS/mecab-0.996-1.el6.src.rp=
m=0A=0A=
http://packages.groonga.org/centos/6/source/SRPMS/mecab-ipadic-2.7.0.20070=
801-8.el6.1.src.rpm=0A=0A=
http://packages.groonga.org/centos/6/source/SRPMS/mecab-jumandic-5.1.20070=
304-9.el6.src.rpm=0A=0A=
MeCab=E8=BE=9E=E6=9B=B8=E3=82=92=E5=85=A8=E6=96=87=E6=A4=9C=E7=B4=A2=E3=82=
=A8=E3=83=B3=E3=82=B8=E3=83=B3Groonga=E7=94=A8=E3=81=AB=E8=AA=BF=E6=95=B4=E3=
=81=99=E3=82=8B=E6=96=B9=E6=B3=95=0A=
http://createfield.com/MeCab%E8%BE%9E%E6%9B%B8%E3%82%92%E5%85%A8%E6%96%87%=
E6%A4%9C%E7%B4%A2%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%B3Groonga%E7%94%A8%E3%8=
1%AB%E8%AA%BF%E6%95%B4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95=0A=0A=
MeCab=E3=81=A7=E6=9C=AA=E7=9F=A5=E8=AA=9E=E3=82=92=E9=95=B7=E3=81=84=E3=82=
=B5=E3=82=A4=E3=82=BA=E3=81=A7=E5=8C=BA=E5=88=87=E3=82=8B=E6=96=B9=E6=B3=95=
=0A=
http://createfield.com/MeCab%E3%81%A7%E6%9C%AA%E7%9F%A5%E8%AA%9E%E3%82%92%=
E9%95%B7%E3%81%84%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%A7%E5%8C%BA%E5%88%87%E3=
%82%8B%E6%96%B9%E6%B3%95=0A=0A=0Aspec=E3=81=AE=E5=8F=96=E3=82=8A=E5=87=BA=E3=
=81=97=0Arpm2cpio=20mecab-0.996-1.el6.src.rpm=20|=20cpio=20-idv=20=
mecab.spec=0A=0A=E5=85=A8=E3=81=A6=E3=81=AE=E5=8F=96=E3=82=8A=E5=87=BA=E3=81=
=97=0Arpm2cpio=20mecab-0.996-1.el6.src.rpm=20|=20cpio=20-id=0A=0A=0A=0A=
To=20enable=20dictionary,=20rewrite=20/etc/mecabrc=20as=20"dicdir=20=3D=20=
/usr/lib64/mecab/dic/naist-jdic"=0A=

--Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622
Content-Disposition: attachment;
	filename*=utf-8''%E4%B8%AD%E5%9B%BD%E8%AA%9E
Content-Type: application/octet-stream;
	x-mac-type=54455854;
	x-mac-creator=4D4D4B45;
	x-unix-mode=0644;
	name="=?utf-8?B?5Lit5Zu96Kqe?="
Content-Transfer-Encoding: base64

44Ot44O844K944OzICDnvZfmo67vvIhsdcOzIHPEk27vvIkKCuOCreODo+ODjuODsyAg5L2z6IO9
77yIamnEgSBuw6luZyDvvIkKU09OWSAgICAg57Si5bC877yIc3XHkiBuw60g77yJCuaXpeeriyAg
ICAgIOaXpeeri++8iHLDrCBsw6zvvIkKCuixiueUsCAgICAgIOS4sOeUsO+8iGbEk25nIHRpw6Fu
77yJCuODm+ODs+ODgCAgICDmnKznlLDvvIhixJtuIHRpw6FuIO+8iQoKCgrjgYLjga7vvZ4g6YKj
5LiqCk7DoGfDqAoKCuaIkeWQg+mjveS6huOAgemDveW+iOWlveWQgwpXx5IgY2jEqyBix45vbGUs
IGTFjXUgaMSbbiBow6BvIGNoxKsKCgrnn6XpgZPkuoblkJcKWmjEq2TDoG9sZSBtYT8KCgrmsqHk
uosgOiDlpKfkuIjlpKvjgIHmsJfjgavjgZfjgarjgYTjgacKbcOpaSBzaMOsCgoK54S25ZCO5ZGi
IDrjgZ3jgozjgYvjgonjga3jgY/jgonjgYTjga7mhI/lkbPjgafjgZnjgIIKUsOhbmjDsnUgbmUK
CgrkvaDop4nlvpflkaLvvJ86IOWQm+OBr+OBqeOBhuaAneOBhu+8iOaEn+OBmOOCi++8ie+8nwpO
x5AganXDqWRlIG5lCgoK5L2g6K+05ZGi77yfOiDlkJvjga/jganjgYbmgJ3jgYbvvJ8KTseQIHNo
dcWNIG5lCgoK5oiR55qE5oSP5oCd5piv4oCm4oCm44CCOiDnp4HjgYzoqIDjgYTjgZ/jgYTjga7j
ga/igKbjgIIKV8eSIGRlIHnDrHNpIHNow6wKCgrkvaDnmoTmhI/mgJ3mmK/igKbigKbjgII6IOOB
pOOBvuOCiuOAgeWQm+OBjOiogOOBhOOBn+OBhOOBruOBr+KApuOAggpOx5AgZGUgecOsc2kgc2jD
rAoKCuWPjeato+WRou+8jDog44Gp44Gj44Gh44Gr44GX44Gm44KC44CBCkbHjm56aMOobmcgbmUK
Cgrlho3or7TvvIw6IOOBneOCjOOBq+OAgQpaw6Bpc2h1xY0KCgrlhbblrp46IOWun+OBrwpRw61z
aMOtCgoK5oCO5LmI6K+05ZGi77yfOiDjganjgYboqIDjgaPjgZ/jgonjgYTjgYTjgpPjgaDjgo3j
gYbvvJ8KWsSbbm1lIHNodcWNIG5lCgoK5ZOm77yM5a+55LqG44CCOiDjgYLjgIHjgZ3jgYbjgZ3j
gYbjgIIKw5MsIGR1w6xsZQoKCuaIkeS7peS4uuKApuKApuOAgjog4oCm44Gg44Go5oCd44Gj44Gm
44Gf44KT44Gg44GR44Gp44CCClfHkiB5x5B3w6lpCgoK5Lmf5bCx5piv6K+077yMOiDjgaTjgb7j
gorliKXjga7oqIDjgYTmlrnjgpLjgZnjgovjgajjgIEKWcSbIGppw7lzaMOsIHNodcWNCgoK6YKj
5YCS5piv44CCOiDjgZ3jgozjgoLjgZ3jgYbjgaDjga3jgIIKTsOgIGTHjm9zaMOsCgoK5Y+v6K+0
5ZGi44CCOiDjgZ3jgYbjgYTjgYjjgbDjgZ3jgYbjgaDjga3jgIIqMQpLxJsgc2h1xY0gbmUKCgrl
k6bvvIzljp/mnaXmmK/ov5nmoLfllYrjgII6IOOBguOAgeOBneOBhuOBoOOBo+OBn+OCk+OBoOOA
ggrDkywgeXXDoW5sw6FpIHNow6wgemjDqHnDoG5nIGEKCgrlhYjov5nmoLflkKfjgII6IOOBqOOC
iuOBguOBiOOBmuOBk+OBhuOBl+OCiOOBhuOAggpYacSBbiB6aMOoecOgbmcgYmEKCgrku6XlkI7l
ho3or7TlkKfjgII6IOW+jOOBp+OBvuOBn+iAg+OBiOOCiOOBhuOAggpZx5Bow7J1IHrDoGlzaHXF
jSBiYQoKCuWFiOKApuKApuS6huWGjeivtOWQp+OAgjog44G+44Ga4oCm44GX44Gm44GX44G+44GK
44GG44CCClhpxIFu4oCm4oCmbGUgesOgaXNodcWNIGJhCgoK6LCB6K+055qE77yfOiDoqrDjgYzj
gZ3jgpPjgarjgZPjgajoqIDjgaPjgZ/jga7vvJ8KU2h1w60gc2h1xY0gZGUKCgrlkKbliJnvvIw6
IOOBneOBhuOBl+OBquOBhOOBqOOAgQpGx5J1esOpCgoK57uT5p6c5piv4oCm4oCm44CCOiDntZDl
sYDigKbjgajjgYTjgYbjgZPjgajjgavjgarjgaPjgZ/jgIIKSmnDqWd1x5Igc2jDrAoKCumCo+W9
k+eEtuWYm+OAgjog44Gd44KK44KD44KC44Gh44KN44KT44Gg44KI44CCCk7DoCBkxIFuZ3LDoW4g
bWEKCgrpgqPov5jnlKjor7TlkJfvvJ86IOOBneOCiuOCg+OCguOBoeOCjeOCk+OBoOOCiOOAgu+8
iOebtOioszog44Gd44KM44Gv6KiA44GG5b+F6KaB44GC44KL77yf77yJCk7DoCBow6FpIHnDsm5n
IHNodcWNIG1hCgoK5oiR5peg5omA6LCT44CCOiDnp4Hjga/jgYvjgb7jgo/jgarjgYTvvIjkvZXj
gafjgoLjgYTjgYTvvInjgIIKV8eSIHfDunN1x5J3w6hpCgoK5LiN6Iez5LqO5ZCn44CCOiDjgZ3j
gZPjgb7jgafjgZnjgovlv4XopoHjga/jgarjgYTjgafjgZfjgofjgYYv44Gd44GT44G+44Gn44Gu
44GT44Go44Gr44Gv44Gq44KJ44Gq44GE44Gn44GX44KH44GG44CCCkLDuSB6aMOsecO6IGJhCgoK
5oiR6Lef5L2g6K+077yMOiDoqIDjgaPjgabjgYrjgY/jgZHjganjga3jgIEKV8eSIGfEk24gbseQ
IHNodcWNCgoK54S25ZCO5ZGi77yfOiDjgZ3jgozjgafvvJ8KUsOhbmjDsnUgbmUKCg==

--Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622
Content-Disposition: attachment;
	filename*=utf-8''%E6%88%90%E5%8A%9F
Content-Type: application/octet-stream;
	x-mac-type=54455854;
	x-mac-creator=4D4D4B45;
	x-unix-mode=0644;
	name="=?utf-8?B?5oiQ5Yqf?="
Content-Transfer-Encoding: quoted-printable

/**=0A=20*=20ETL=0A=20*=20=20src:=20CSV=0A=20*=20=20dst:=20MongoDB=0A=20=
*=0A=20*/=0A=0A"use=20strict";=0A=0Avar=20_=20=3D=20=
require("underscore")=0A=20=20,=20async=20=3D=20require("async")=0A=20=20=
,=20path=20=3D=20require('path')=0A=20=20,=20fs=20=3D=20require('fs')=0A=20=
=20,=20csv=20=3D=20require('csv')=0A=20=20;=0A=0A/**=0A=20*=20=
CSV=E3=82=A4=E3=83=B3=E3=83=9D=E3=83=BC=E3=83=88=0A=20*=0A=20*=20@param=20=
db=0A=20*=20@param=20confs=0A=20*=20@param=20store=0A=20*=20@param=20=
callback=0A=20*/=0Aexports.load=20=3D=20function=20(db,=20definition,=20=
store,=20callback)=20{=0A=20=20//=20=E3=82=B8=E3=83=A7=E3=83=96=E3=82=92=E9=
=A0=86=E7=95=AA=E3=81=AB=E5=87=A6=E7=90=86=E3=81=99=E3=82=8B=0A=20=20=
async.mapSeries(definition.jobs,=20function=20(job,=20next)=20{=0A=20=20=20=
=20job.start=20=3D=20definition.start;=0A=20=20=20=20job.system=20=3D=20=
definition.system;=0A=20=20=20=20load_one(db,=20job,=20store,=20function=20=
(err,=20count)=20{=0A=20=20=20=20=20=20if=20(err)=20{=0A=20=20=20=20=20=20=
=20=20next(err);=20//=20=
=E3=82=A8=E3=83=A9=E3=83=BC=E3=81=AE=E5=A0=B4=E5=90=88=E3=81=AF=E3=81=9D=E3=
=81=AE=E6=99=82=E7=82=B9=E3=81=A7=E7=B5=82=E4=BA=86=E3=80=82=E5=87=A6=E7=90=
=86=E4=BB=B6=E6=95=B0=E3=81=AFnull=E3=81=A8=E3=81=97=E3=81=A6=E8=BF=94=E3=81=
=99=E3=80=82=0A=20=20=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=20=20=
next(null,=20count);=0A=20=20=20=20=20=20}=0A=20=20=20=20});=0A=20=20},=20=
function=20(err,=20results)=20{=0A=20=20=20=20if=20(err)=20{=0A=20=20=20=20=
=20=20callback(err,=20null);=20//=20=
=E3=82=A8=E3=83=A9=E3=83=BC=E3=81=AE=E5=A0=B4=E5=90=88=E3=81=AF=E3=81=9D=E3=
=81=AE=E6=99=82=E7=82=B9=E3=81=A7=E7=B5=82=E4=BA=86=E3=80=82=E5=87=A6=E7=90=
=86=E4=BB=B6=E6=95=B0=E3=81=AFnull=E3=81=A8=E3=81=97=E3=81=A6=E8=BF=94=E3=81=
=99=E3=80=82=0A=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=
callback(null,=20results);=20//=20=E3=81=99=E3=81=B9=E3=81=A6=E6=AD=A3=E5=B8=
=B8=E7=B5=82=E4=BA=86=E3=81=AE=E5=A0=B4=E5=90=88=0A=20=20=20=20}=0A=20=20=
});=0A}=0A=0Afunction=20load_one(db,=20conf,=20store,=20callback)=20{=0A=0A=
=20=20var=20collection=20=3D=20db.collection(conf.collection);=0A=0A=20=20=
//=20System=20Key=0A=20=20var=20system=20=3D=20{};=0A=20=20conf.system=20=
&&=20conf.system.forEach(function=20(info)=20{=0A=20=20=20=20=
set_value(info.value,=20system,=20info,=20{});=0A=20=20});=0A=0A=20=20=
var=20pkeys=20=3D=20[];=20//=20Primary=20Keys=0A=20=20var=20okeys=20=3D=20=
{};=20//=20not=20Overwrite=20Keys=0A=20=20conf.fields.forEach(function=20=
(field)=20{=0A=20=20=20=20if=20(field.key)=20{=0A=20=20=20=20=20=20=
pkeys.push(field);=0A=20=20=20=20}=0A=20=20=20=20if=20(field.overwrite=20=
=3D=3D=3D=20false)=20{=0A=20=20=20=20=20=20okeys[field.field]=20=3D=201;=0A=
=20=20=20=20}=0A=20=20});=0A=20=20okeys["createAt"]=20=3D=201;=20//=20=
=E4=BD=9C=E6=88=90=E6=97=A5=E6=99=82=E3=81=AF=E4=B8=8A=E6=9B=B8=E3=81=8D=E3=
=81=97=E3=81=AA=E3=81=84=0A=0A=20=20var=20maps=20=3D=20{};=20//=20=
=E5=8F=82=E7=85=A7=E8=A7=A3=E6=B1=BAmap=0A=20=20var=20self_map=20=3D=20=
{};=20//=20=E8=87=AA=E8=BA=AB=E3=81=AE=20key->_id=20map=0A=20=20var=20=
tasks=20=3D=20[];=0A=0A=20=20//=20Phase=201.=20Check.=0A=20=20=
tasks.push(function=20(done)=20{=0A=20=20=20=20store.seek(0,=20function=20=
(err,=20store)=20{=0A=20=20=20=20=20=20var=20stream=20=3D=20=
store.stream(true);=0A=20=20=20=20=20=20var=20target=20=3D=20csv()=0A=20=20=
=20=20=20=20=20=20.from.stream(stream,=20{=20delimiter:=20',',=20escape:=20=
'"'=20});=0A=20=20=20=20=20=20target.on('record',=20function=20(row,=20=
index)=20{=0A=20=20=20=20=20=20=20=20if=20(conf.start=20<=3D=20index)=20=
{=0A=20=20=20=20=20=20=20=20=20=20check(system,=20collection,=20row,=20=
conf.fields,=20pkeys,=20okeys,=20self_map,=20maps);=0A=20=20=20=20=20=20=20=
=20=20=20if=20(index=20%=201000=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=
=20=20=20=20=20console.log("Phase=201.=20Check.=20now=20"=20+=20index);=0A=
=20=20=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20=20=20}=0A=20=20=20=20=
=20=20});=0A=20=20=20=20=20=20target.on('end',=20function=20(count)=20{=0A=
=20=20=20=20=20=20=20=20//=201=E5=9B=9E=E7=9B=AE=E3=81=AB=E3=83=88=E3=83=BC=
=E3=82=BF=E3=83=AB=E4=BB=B6=E6=95=B0=E3=82=92=E6=8A=8A=E6=8F=A1=E3=81=99=E3=
=82=8B=0A=20=20=20=20=20=20=20=20console.log("total=20count=20:=20"=20+=20=
count);=0A=20=20=20=20=20=20=20=20count=20-=3D=20conf.start;=0A=20=20=20=20=
=20=20=20=20done(null,=20self_map,=20maps,=20count);=0A=20=20=20=20=20=20=
});=0A=20=20=20=20=20=20target.on('error',=20function=20(error)=20{=0A=20=
=20=20=20=20=20=20=20done(error);=0A=20=20=20=20=20=20});=0A=20=20=20=20=
});=0A=20=20});=0A=0A=20=20//=20Phase=202.=20Pre=20Create.=0A=20=20=
tasks.push(function=20(self_map,=20maps,=20total,=20done)=20{=0A=20=20=20=
=20async.each(_.keys(self_map),=20function=20(key,=20next)=20{=0A=20=20=20=
=20=20=20pre_record(system,=20collection,=20key,=20conf,=20pkeys,=20=
self_map,=20maps,=20function=20()=20{=0A=20=20=20=20=20=20=20=20=
next(null);=0A=20=20=20=20=20=20});=0A=20=20=20=20},=20function=20(err)=20=
{=0A=20=20=20=20=20=20done(null,=20maps,=20total);=0A=20=20=20=20});=0A=20=
=20});=0A=0A=20=20//=20Phase=203.=20Outer/Inner=20Object=20Gather.=0A=20=20=
tasks.push(function=20(maps,=20total,=20done)=20{=0A=20=20=20=20//=20=
maps=20:=20{type:=20info.type,=20refer:=20info.refer,=20map:=20{}};=0A=20=
=20=20=20var=20keys=20=3D=20Object.keys(maps);=0A=20=20=20=20var=20N=20=3D=
=20keys.length;=0A=20=20=20=20keys.forEach(function=20(key)=20{=0A=20=20=20=
=20=20=20var=20map=20=3D=20maps[key];=0A=20=20=20=20=20=20if=20=
(map.info.refer)=20{=0A=20=20=20=20=20=20=20=20//=20=E5=8F=82=E7=85=A7=E8=A7=
=A3=E6=B1=BA=0A=20=20=20=20=20=20=20=20do_map(db,=20map.info.refer,=20=
map.map,=20function=20(err)=20{=0A=20=20=20=20=20=20=20=20=20=20if=20=
(--N=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=20=20=20=20=20done(null,=20=
maps,=20total);=0A=20=20=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20=20=
=20});=0A=20=20=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=20=20if=20=
(--N=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=20=20=20done(null,=20=
maps,=20total);=0A=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20}=0A=20=20=
=20=20});=0A=20=20});=0A=0A=20=20//=20Phase=204.=20Import.=0A=20=20=
tasks.push(function=20(maps,=20total,=20done)=20{=0A=20=20=20=20var=20n=20=
=3D=20total;=0A=20=20=20=20store.seek(0,=20function=20(err,=20store)=20{=0A=
=20=20=20=20=20=20var=20stream=20=3D=20store.stream(true);=0A=20=20=20=20=
=20=20var=20target=20=3D=20csv()=0A=20=20=20=20=20=20=20=20=
.from.stream(stream,=20{=20delimiter:=20',',=20escape:=20'"'=20});=0A=20=20=
=20=20=20=20target.on('record',=20function=20(row,=20index)=20{=0A=20=20=20=
=20=20=20=20=20if=20(conf.start=20<=3D=20index)=20{=0A=20=20=20=20=20=20=20=
=20=20=20record(system,=20collection,=20row,=20conf,=20pkeys,=20okeys,=20=
maps,=20function=20()=20{=0A=20=20=20=20=20=20=20=20=20=20=20=20if=20=
((total=20-=20n)=20%=201000=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=20=20=
=20=20=20=20=20console.log("Phase=204.=20Import.=20now=20"=20+=20(total=20=
-=20n)=20+=20"=20/=20"=20+=20total);=0A=20=20=20=20=20=20=20=20=20=20=20=20=
}=0A=20=20=20=20=20=20=20=20=20=20=20=20if=20(--n=20=3D=3D=200)=20{=0A=20=
=20=20=20=20=20=20=20=20=20=20=20=20=20//=20=
=E3=83=88=E3=83=BC=E3=82=BF=E3=83=AB=E4=BB=B6=E6=95=B0=E3=82=92=E5=87=A6=E7=
=90=86=E3=81=97=E3=81=9F=E3=82=89=E7=B5=82=E4=BA=86=0A=20=20=20=20=20=20=20=
=20=20=20=20=20=20=20done(null,=20maps,=20total);=0A=20=20=20=20=20=20=20=
=20=20=20=20=20}=0A=20=20=20=20=20=20=20=20=20=20});=0A=20=20=20=20=20=20=
=20=20}=0A=20=20=20=20=20=20});=0A=20=20=20=20=20=20target.on('end',=20=
function=20(count)=20{=0A=20=20=20=20=20=20=20=20count=20-=3D=20=
conf.start;=0A=20=20=20=20=20=20});=0A=20=20=20=20=20=20=
target.on('error',=20function=20(error)=20{=0A=20=20=20=20=20=20=20=20=
done(error);=0A=20=20=20=20=20=20});=0A=20=20=20=20});=0A=20=20});=0A=0A=20=
=20async.waterfall(tasks,=20function=20(err,=20maps,=20total)=20{=0A=20=20=
=20=20if=20(err)=20{=0A=20=20=20=20=20=20callback(err,=20null);=0A=20=20=20=
=20=20=20return;=0A=20=20=20=20}=0A=20=20=20=20callback(err,=20total);=0A=
=20=20});=0A=0A}=0A=0A/**=0A=20*=20=E5=89=8D=E5=87=A6=E7=90=86=0A=20*=20=
1)=20Validation=0A=20*=202)=20=E5=8F=82=E7=85=A7=E8=A7=A3=E6=B1=BA=20Map=20=
=E4=BD=9C=E6=88=90=0A=20*=0A=20*=20@param=20system=0A=20*=20@param=20=
collection=0A=20*=20@param=20row=0A=20*=20@param=20fields=0A=20*=20=
@param=20pkeys=0A=20*=20@param=20maps=0A=20*=20@param=20callback=0A=20*/=0A=
function=20check(system,=20collection,=20row,=20fields,=20pkeys,=20=
okeys,=20self_map,=20maps)=20{=0A=0A=20=20//=20todo:=20Validation=0A=0A=0A=
=20=20//=20PKey=0A=20=20var=20query2=20=3D=20{};=0A=20=20var=20values=20=
=3D=20field_copy(row,=20query2,=20pkeys,=20maps);=0A=20=20if=20(0=20<=20=
values.length=20=3D=3D=200)=20{=0A=20=20=20=20//=20pkey=20=
=E3=81=8C=E3=81=AA=E3=81=84=E3=81=AA=E3=82=89=E4=BD=95=E3=82=82=E3=81=97=E3=
=81=AA=E3=81=84=0A//=20=20=20=20return=20callback(null);=0A=20=20}=0A=0A=20=
=20//=20=E8=87=AA=E8=BA=AB=E3=81=AE=20key->_id=20map=20=E7=94=9F=E6=88=90=0A=
=20=20var=20key=20=3D=20JSON.stringify(query2);=0A=20=20if=20(key=20!=3D=20=
"")=20{=0A=20=20=20=20self_map[key]=20=3D=20query2;=0A=20=20}=0A=0A=20=20=
var=20query=20=3D=20{};=0A=20=20field_copy(row,=20query,=20fields,=20=
maps);=0A=0A=0A}=0A=0A/**=0A=20*=20=E5=8F=82=E7=85=A7=E8=A7=A3=E6=B1=BA=0A=
=20*=0A=20*=20@param=20refer=0A=20*=20@param=20map=0A=20*/=0Afunction=20=
do_map(db,=20refer,=20map,=20callback)=20{=0A=20=20var=20collection=20=3D=20=
db.collection(refer.collection);=0A=20=20var=20field=20=3D=20refer.field=20=
||=20'_id';=0A=20=20var=20keys=20=3D=20Object.keys(map);=0A=20=20var=20=
match=20=3D=20refer.match;=0A=0A=20=20var=20query=20=3D=20=
_$(refer.match,=20{$in:=20keys});=0A=20=20var=20column=20=3D=20_$(field,=20=
1);=0A=20=20column[match]=20=3D=201;=0A=0A=20=20collection.find(query,=20=
column,=20function=20(err,=20results)=20{=0A=20=20=20=20if=20(err)=20{=0A=
=20=20=20=20=20=20callback(err);=0A=20=20=20=20}=0A=20=20=20=20=
results.each(function=20(err,=20result)=20{=0A=20=20=20=20=20=20if=20=
(result)=20{=0A=20=20=20=20=20=20=20=20map[get_value(result,=20match)]=20=
=3D=20get_value(result,=20field);=0A=20=20=20=20=20=20}=20else=20{=0A=20=20=
=20=20=20=20=20=20callback(null,=20map);=0A=20=20=20=20=20=20}=0A=20=20=20=
=20})=0A=20=20})=0A}=0A=0A/**=0A=20*=20=
=E3=82=AA=E3=83=96=E3=82=B8=E3=82=A7=E3=82=AF=E3=83=88ID=E4=BA=88=E7=B4=84=
(=E3=82=AD=E3=83=BC=E3=81=A0=E3=81=91=E3=82=92=E3=82=BB=E3=83=83=E3=83=88=E3=
=81=97=E3=81=9F=E3=82=AA=E3=83=96=E3=82=B8=E3=82=A7=E3=82=AF=E3=83=88=E3=82=
=92=E4=BF=9D=E5=AD=98=E3=81=97=E3=81=A6ID=E3=82=92=E7=A2=BA=E5=AE=9A=E3=81=
=99=E3=82=8B)=0A=20*=0A=20*=20@param=20system=0A=20*=20@param=20=
collection=0A=20*=20@param=20row=0A=20*=20@param=20fields=0A=20*=20=
@param=20pkeys=0A=20*=20@param=20maps=0A=20*=20@param=20callback=0A=20*/=0A=
function=20pre_record(system,=20collection,=20key,=20conf,=20pkeys,=20=
self_map,=20maps,=20callback)=20{=0A=0A=20=20//=20PKey=0A=20=20var=20=
query=20=3D=20self_map[key];=0A=0A=20=20//=20fields:=20{createAt:=201}=20=
=E3=83=95=E3=82=A3=E3=83=BC=E3=83=AB=E3=83=89=E3=81=AF=20_id=20=E3=81=A8=20=
createAt=20=E3=81=A0=E3=81=91=E3=82=92=E5=8F=96=E5=BE=97=E3=81=99=E3=82=8B=
=E3=80=82=0A=20=20//=20upsert:=20true=20=20=20=20=20=20=20=20=20=20=
=E5=AD=98=E5=9C=A8=E3=81=97=E3=81=AA=E3=81=91=E3=82=8C=E3=81=B0=E3=80=81=E3=
=81=9D=E3=81=AE=E7=9E=AC=E9=96=93=E3=81=AB=20insert=20=E3=81=99=E3=82=8B=E3=
=80=82=0A=20=20var=20option=20=3D=20{fields:=20{createAt:=201},=20=
upsert:=20true};=0A=20=20collection.findAndModify(query,=20null,=20=
{$set:=20query},=20option,=20function=20(err,=20result)=20{=0A=20=20=20=20=
if=20(err)=20{=0A=20=20=20=20=20=20callback(err);=0A=20=20=20=20}=20else=20=
{=0A=20=20=20=20=20=20//=20_id=20=E3=81=AE=E7=94=9F=E6=88=90=E3=81=A0=E3=81=
=91=E3=81=A7=E3=81=8D=E3=82=8C=E3=81=B0=E3=82=88=E3=81=84=E3=80=82=0A=20=20=
=20=20=20=20self_map[key]=20=3D=20result;=0A=20=20=20=20=20=20=
callback(err,=20result);=0A=20=20=20=20}=0A=20=20});=0A=0A}=0A=0A/**=0A=20=
*=20=E3=82=A4=E3=83=B3=E3=83=9D=E3=83=BC=E3=83=88=E5=87=A6=E7=90=86=0A=20=
*=0A=20*=20@param=20system=0A=20*=20@param=20collection=0A=20*=20@param=20=
row=0A=20*=20@param=20fields=0A=20*=20@param=20pkeys=0A=20*=20@param=20=
callback=0A=20*/=0Afunction=20record(system,=20collection,=20row,=20=
conf,=20pkeys,=20okeys,=20maps,=20callback)=20{=0A=0A=20=20var=20fields=20=
=3D=20conf.fields;=0A=20=20var=20condition=20=3D=20conf.condition;=0A=0A=20=
=20//=20PKey=0A=20=20var=20query=20=3D=20{};=0A=20=20var=20values=20=3D=20=
field_copy(row,=20query,=20pkeys,=20maps);=0A=20=20if=20(values.length=20=
=3D=3D=200)=20{=0A=20=20=20=20//=20pkey=20=E3=81=8C=E3=81=AA=E3=81=84=E3=81=
=AA=E3=82=89=E4=BD=95=E3=82=82=E3=81=97=E3=81=AA=E3=81=84=0A=20=20=20=20=
callback(null);=0A=20=20=20=20return;=0A=20=20}=0A=0A=20=20//=20fields:=20=
okeys=20=20=20=E3=83=95=E3=82=A3=E3=83=BC=E3=83=AB=E3=83=89=E3=81=AF=20=
_id=20=E3=81=A8=20okeys=20=E3=82=92=E5=8F=96=E5=BE=97=E3=81=99=E3=82=8B=E3=
=80=82=0A=20=20//=20upsert:=20true=20=20=20=20=
=E5=AD=98=E5=9C=A8=E3=81=97=E3=81=AA=E3=81=91=E3=82=8C=E3=81=B0=E3=80=81=E3=
=81=9D=E3=81=AE=E7=9E=AC=E9=96=93=E3=81=AB=20insert=20=E3=81=99=E3=82=8B=E3=
=80=82=0A=20=20var=20option=20=3D=20{fields:=20okeys,=20upsert:=20true};=0A=
=20=20collection.findAndModify(query,=20null,=20{$set:=20query},=20=
option,=20function=20(err,=20result)=20{=0A=20=20=20=20if=20(err)=20{=0A=20=
=20=20=20=20=20callback(err);=0A=20=20=20=20=20=20return;=0A=20=20=20=20=
}=20else=20{=0A=20=20=20=20=20=20//=20=
=E3=83=AC=E3=82=B3=E3=83=BC=E3=83=89=E3=81=8C=E6=9D=A1=E4=BB=B6=E3=81=AB=E4=
=B8=80=E8=87=B4=E3=81=97=E3=81=A6=E3=81=84=E3=82=8B=E3=81=8B=EF=BC=9F=0A=20=
=20=20=20=20=20if=20(!check_record_condition(row,=20condition))=20{=0A=20=
=20=20=20=20=20=20=20callback(err,=20result);=0A=20=20=20=20=20=20=20=20=
return;=0A=20=20=20=20=20=20}=0A=0A=20=20=20=20=20=20//=20=
=E3=82=A4=E3=83=B3=E3=83=9D=E3=83=BC=E3=83=88=E5=87=A6=E7=90=86=0A=20=20=20=
=20=20=20var=20now=20=3D=20new=20Date();=0A=20=20=20=20=20=20var=20obj=20=
=3D=20clone_obj(system);=0A=20=20=20=20=20=20field_copy(row,=20obj,=20=
fields,=20maps);=0A=20=20=20=20=20=20obj["createAt"]=20=3D=20now;=0A=20=20=
=20=20=20=20obj["updateAt"]=20=3D=20now;=0A=0A=20=20=20=20=20=20//=20=
=E4=B8=8A=E6=9B=B8=E3=81=8D=E3=81=97=E3=81=AA=E3=81=84=E3=83=95=E3=82=A3=E3=
=83=BC=E3=83=AB=E3=83=89=0A=20=20=20=20=20=20for=20(var=20key=20in=20=
okeys)=20{=0A=20=20=20=20=20=20=20=20obj[key]=20=3D=20result[key]=20||=20=
obj[key];=0A=20=20=20=20=20=20}=0A=0A=20=20=20=20=20=20//=20=
conf.operation=20[$set|$addToSet|$pull]=0A=20=20=20=20=20=20var=20method=20=
=3D=20conf.operation=20||=20"$set";=0A=20=20=20=20=20=20if=20(method=20=
=3D=3D=20"$set")=20{=0A=20=20=20=20=20=20=20=20//=20=E6=9B=B4=E6=96=B0=0A=
=20=20=20=20=20=20=20=20collection.update({_id:=20result._id},=20{$set:=20=
obj},=20function=20(err,=20result0)=20{=0A=20=20=20=20=20=20=20=20=20=20=
if=20(err)=20{=0A=20=20=20=20=20=20=20=20=20=20=20=20callback(err,=20=
result0);=0A=20=20=20=20=20=20=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=
=20=20=20=20=20=20callback(err,=20result0);=0A=20=20=20=20=20=20=20=20=20=
=20}=0A=20=20=20=20=20=20=20=20});=0A=20=20=20=20=20=20}=20else=20{=0A=20=
=20=20=20=20=20=20=20//=20=E8=BF=BD=E5=8A=A0/=E5=89=8A=E9=99=A4=0A=20=20=20=
=20=20=20=20=20var=20count=20=3D=200;=0A=20=20=20=20=20=20=20=20for=20=
(var=20key=20in=20obj)=20{=0A=20=20=20=20=20=20=20=20=20=20var=20values=20=
=3D=20obj[key];=0A=20=20=20=20=20=20=20=20=20=20if=20(values=20=
instanceof=20Array)=20{=0A=20=20=20=20=20=20=20=20=20=20=20=20count=20+=3D=
=20values.length;=0A=20=20=20=20=20=20=20=20=20=20=20=20=
values.forEach(function=20(value)=20{=0A=20=20=20=20=20=20=20=20=20=20=20=
=20=20=20var=20_target=20=3D=20_$(method,=20_$(key,=20value));=0A=20=20=20=
=20=20=20=20=20=20=20=20=20=20=20collection.update({_id:=20result._id},=20=
_target,=20function=20(err,=20result0)=20{=0A=20=20=20=20=20=20=20=20=20=20=
=20=20=20=20=20=20if=20(--count=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=
=20=20=20=20=20=20=20=20=20=20=20callback(err,=20result0);=0A=20=20=20=20=
=20=20=20=20=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20=20=20=20=20=20=
=20=20=20});=0A=20=20=20=20=20=20=20=20=20=20=20=20});=0A=20=20=20=20=20=20=
=20=20=20=20}=0A=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20=20=20if=20=
(count=20=3D=3D=200)=20{=0A=20=20=20=20=20=20=20=20=20=20callback(err,=20=
null);=0A=20=20=20=20=20=20=20=20}=0A=20=20=20=20=20=20}=0A=20=20=20=20}=0A=
=20=20});=0A}=0A=0A/**=0A=20*=20=
=E3=83=AC=E3=82=B3=E3=83=BC=E3=83=89=E3=81=8C=E6=9D=A1=E4=BB=B6=E3=81=AB=E4=
=B8=80=E8=87=B4=E3=81=97=E3=81=A6=E3=81=84=E3=82=8B=E3=81=8B=EF=BC=9F=0A=20=
*=0A=20*=20condition:=20[=0A=20*=20=20{=0A=20*=20=20=20=20column:=209,=20=
//=209:=E3=83=AD=E3=83=BC=E3=83=AB=E5=89=8A=E9=99=A4=E3=83=95=E3=83=A9=E3=82=
=B0=20(1:=E5=89=8A=E9=99=A4)=0A=20*=20=20=20=20value:=20"1",=0A=20*=20=20=
=20=20not:=20true=20//=20=E5=90=A6=E5=AE=9A=E6=9D=A1=E4=BB=B6=E3=81=AB=E3=81=
=99=E3=82=8B=E5=A0=B4=E5=90=88:true=0A=20*=20=20}=0A=20*=20=20]=0A=20*=0A=
=20*=20@param=20row=0A=20*=20@param=20conds=0A=20*=20@returns=20=
{boolean}=0A=20*/=0Afunction=20check_record_condition(row,=20conds)=20{=0A=
=20=20var=20check=20=3D=20true;=0A=20=20conds=20&&=20=
conds.forEach(function=20(cond)=20{=0A=20=20=20=20//=20todo:=20=
=E3=83=95=E3=82=A9=E3=83=BC=E3=83=9E=E3=83=83=E3=83=88=E5=A4=89=E6=8F=9B=E3=
=81=8C=E3=81=84=E3=82=8B=EF=BC=9F=0A=20=20=20=20if=20(row[cond.column]=20=
!=3D=20cond.value)=20{=0A=20=20=20=20=20=20if=20(cond.not=20&&=20=
cond.not=20=3D=3D=20true)=20{=0A=20=20=20=20=20=20=20=20//=20nothing.=0A=20=
=20=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=20=20check=20=3D=20=
false;=0A=20=20=20=20=20=20}=0A=20=20=20=20}=20else=20{=0A=20=20=20=20=20=
=20if=20(cond.not=20&&=20cond.not=20=3D=3D=20true)=20{=0A=20=20=20=20=20=20=
=20=20check=20=3D=20false;=0A=20=20=20=20=20=20}=20else=20{=0A=20=20=20=20=
=20=20=20=20//=20nothing.=0A=20=20=20=20=20=20}=0A=20=20=20=20}=0A=20=20=
});=0A=20=20return=20check;=0A}=0A=0A//=20(key,value)=20=
=E3=81=AE=E3=82=AA=E3=83=96=E3=82=B8=E3=82=A7=E3=82=AF=E3=83=88=0A=
function=20_$(key,=20value)=20{=0A=20=20var=20result=20=3D=20{};=0A=20=20=
result[key]=20=3D=20value;=0A=20=20return=20result;=0A}=0A=0A/**=0A=20*=20=
=E3=80=8C.(=E3=83=89=E3=83=83=E3=83=88)=E3=80=8D=E5=8C=BA=E5=88=87=E3=82=8A=
=E3=81=AE=E3=83=97=E3=83=AD=E3=83=91=E3=83=86=E3=82=A3=E3=82=92=E5=8F=96=E5=
=BE=97=E3=81=99=E3=82=8B=0A=20*=20@param=20src=0A=20*=20@param=20field=0A=
=20*=20@returns=20{*}=0A=20*/=0Afunction=20get_value(src,=20field)=20{=0A=
=20=20var=20varSplitter=20=3D=20/\./,=0A=20=20=20=20obj=20=3D=20src,=0A=20=
=20=20=20keyAry=20=3D=20field.split(varSplitter),=0A=20=20=20=20key;=0A=0A=
=20=20while=20(key=20=3D=20keyAry.shift())=20{=0A=20=20=20=20obj=20=3D=20=
obj[key];=0A=20=20=20=20if=20(obj=20=3D=3D=3D=20null=20||=20obj=20=3D=3D=3D=
=20undefined)=20{=0A=20=20=20=20=20=20return=20null;=0A=20=20=20=20}=0A=20=
=20}=0A=20=20return=20obj;=0A};=0A=0A/**=0A=20*=20=
info=E3=81=A7=E7=A4=BA=E3=81=95=E3=82=8C=E3=82=8Bdst=E3=81=AE=E3=83=95=E3=82=
=A3=E3=83=BC=E3=83=AB=E3=83=89=E3=81=ABvalue=E3=82=92=E3=82=BB=E3=83=83=E3=
=83=88=E3=81=99=E3=82=8B=0A=20*=0A=20*=20@param=20value=20=
=E3=82=BB=E3=83=83=E3=83=88=E3=81=99=E3=82=8B=E5=80=A4=0A=20*=20@param=20=
dst=20=E3=82=BB=E3=83=83=E3=83=88=E3=81=99=E3=82=8B=E3=82=AA=E3=83=96=E3=82=
=B8=E3=82=A7=E3=82=AF=E3=83=88=0A=20*=20@param=20info=20=
=E3=82=BB=E3=83=83=E3=83=88=E3=81=99=E3=82=8B=E3=83=95=E3=82=A3=E3=83=BC=E3=
=83=AB=E3=83=89=E6=83=85=E5=A0=B1=20(field,=20type,=20array)=0A=20*=20=
@param=20map=0A=20*/=0Afunction=20set_value(value,=20dst,=20info)=20{=0A=0A=
=20=20var=20field=20=3D=20info.field;=0A=20=20var=20type=20=3D=20=
info.type;=0A=20=20var=20array=20=3D=20info.array;=0A=0A=20=20if=20=
(array)=20{=0A=20=20=20=20//=20=E8=A4=87=E6=95=B0=E5=BD=A2=0A=20=20=20=20=
dst[field]=20=3D=20[];=0A=20=20=20=20if=20(value)=20{=0A=20=20=20=20=20=20=
dst[field].push(evaluate(value,=20type));=0A=20=20=20=20}=0A=20=20}=20=
else=20{=0A=20=20=20=20//=20=E5=8D=98=E6=95=B0=E5=BD=A2=0A=20=20=20=20=
dst[field]=20=3D=20evaluate(value,=20type);=0A=20=20}=0A}=0A=0A/**=0A=20=
*=20=
infos=E3=81=A7=E6=8C=87=E5=AE=9A=E3=81=95=E3=82=8C=E3=81=9F=E3=83=95=E3=82=
=A3=E3=83=BC=E3=83=AB=E3=83=89=E3=81=AB=E3=81=A4=E3=81=84=E3=81=A6=E3=80=81=
src=E3=81=AE=E5=86=85=E5=AE=B9=E3=82=92dst=E3=81=AB=E3=82=B3=E3=83=94=E3=83=
=BC=E3=81=99=E3=82=8B=E3=80=82=0A=20*=0A=20*=20@param=20src=0A=20*=20=
@param=20dst=0A=20*=20@param=20info=0A=20*/=0Afunction=20field_copy(src,=20=
dst,=20infos,=20maps)=20{=0A=20=20var=20values=20=3D=20[];=0A=20=20=
infos.forEach(function=20(info)=20{=0A=20=20=20=20//=20=
=E5=8F=82=E7=85=A7=E3=82=92=E8=A7=A3=E6=B1=BA=E3=81=99=E3=82=8B=E3=81=9F=E3=
=82=81=E3=81=AE=E3=83=9E=E3=83=83=E3=83=97=0A=20=20=20=20=
maps[info.field]=20=3D=20maps[info.field]=20||=20{info:=20info,=20map:=20=
{}};=0A=20=20=20=20var=20map=20=3D=20maps[info.field].map;=0A=0A=20=20=20=
=20//=20=E5=80=A4=E3=82=BB=E3=83=83=E3=83=88=0A=20=20=20=20var=20value=20=
=3D=20info.value=20?=20info.value=20:=20src[info.column];=0A=0A=20=20=20=20=
//=20=E5=8F=82=E7=85=A7=E8=A7=A3=E6=B1=BA=0A=20=20=20=20if=20=
(info.refer)=20{=0A=20=20=20=20=20=20map[value]=20=3D=20map[value]=20||=20=
null;=0A=20=20=20=20=20=20value=20=3D=20map[value];=0A=20=20=20=20}=0A=0A=
=20=20=20=20//=20=E3=83=9E=E3=83=83=E3=83=94=E3=83=B3=E3=82=B0=E8=A7=A3=E6=
=B1=BA=0A=20=20=20=20if=20(info.mapping)=20{=0A=20=20=20=20=20=20value=20=
=3D=20info.mapping[value];=0A=20=20=20=20}=0A=0A=20=20=20=20if=20(value)=20=
{=0A=20=20=20=20=20=20values.push(value);=20//=20=
=E5=80=A4=E3=81=8C=E3=81=82=E3=82=8B=E3=81=8B=E3=83=81=E3=82=A7=E3=83=83=E3=
=82=AF=E3=81=AE=E3=81=9F=E3=82=81=0A=20=20=20=20}=0A=0A=20=20=20=20//=20=
=E7=A9=BA=E3=82=92=E8=A8=B1=E5=8F=AF=E3=81=97=E3=81=AA=E3=81=84=E5=A0=B4=E5=
=90=88=E3=81=AE=E3=81=BF=20(default=20empty:true(=E8=A8=B1=E5=8F=AF=E3=81=99=
=E3=82=8B))=0A=20=20=20=20if=20(info.empty=20=3D=3D=3D=20false)=20{=0A=20=
=20=20=20=20=20if=20(value)=20{=0A=20=20=20=20=20=20=20=20=
set_value(value,=20dst,=20info);=0A=20=20=20=20=20=20}=0A=20=20=20=20}=20=
else=20{=0A=20=20=20=20=20=20set_value(value,=20dst,=20info);=0A=20=20=20=
=20}=0A=0A=20=20});=0A=0A=20=20return=20values;=0A}=0A=0A/**=0A=20*=20=
=E6=96=87=E5=AD=97=E5=88=97value=E3=82=92type=E5=9E=8B=E3=81=AB=E5=A4=89=E6=
=8F=9B=E3=81=99=E3=82=8B=0A=20*=20@param=20value=0A=20*=20@param=20type=0A=
=20*=20@returns=20{*}=0A=20*/=0Afunction=20evaluate(value,=20type)=20{=0A=
=20=20if=20(value=20=3D=3D=20null)=20{=0A=20=20=20=20return=20value;=0A=20=
=20}=0A=20=20switch=20(type)=20{=0A=20=20=20=20case=20"Object":=0A=20=20=20=
=20=20=20return=20value;=0A=20=20=20=20case=20"Number":=0A=20=20=20=20=20=
=20return=20Number(value);=0A=20=20=20=20case=20"String":=0A=20=20=20=20=20=
=20return=20value.toString();=0A=20=20=20=20case=20"Date":=0A=20=20=20=20=
=20=20return=20value=20?=20new=20Date(value=20+=20"=20+0000")=20:=20=
null;=0A=20=20=20=20default:=0A=20=20=20=20=20=20return=20value;=0A=20=20=
}=0A}=0A=0A/**=0A=20*=20deep=20copy=0A=20*=20=
http://bytes.com/topic/javascript/answers/715567-deep-cloning-object=0A=20=
*=20@param=20obj=0A=20*=20@returns=20{{}}=0A=20*/=0Afunction=20=
clone_obj(obj)=20{=0A=20=20var=20c=20=3D=20obj=20instanceof=20Array=20?=20=
[]=20:=20{};=0A=20=20for=20(var=20i=20in=20obj)=20{=0A=20=20=20=20var=20=
prop=20=3D=20obj[i];=0A=20=20=20=20if=20(typeof=20prop=20=3D=3D=20=
'object')=20{=0A=20=20=20=20=20=20if=20(prop=20instanceof=20Array)=20{=0A=
=20=20=20=20=20=20=20=20c[i]=20=3D=20[];=0A=20=20=20=20=20=20=20=20for=20=
(var=20j=20=3D=200;=20j=20<=20prop.length;=20j++)=20{=0A=20=20=20=20=20=20=
=20=20=20=20if=20(typeof=20prop[j]=20!=3D=20'object')=20{=0A=20=20=20=20=20=
=20=20=20=20=20=20=20c[i].push(prop[j]);=0A=20=20=20=20=20=20=20=20=20=20=
}=20else=20{=0A=20=20=20=20=20=20=20=20=20=20=20=20=
c[i].push(clone_obj(prop[j]));=0A=20=20=20=20=20=20=20=20=20=20}=0A=20=20=
=20=20=20=20=20=20}=0A=20=20=20=20=20=20}=20else=20{=0A=20=20=20=20=20=20=
=20=20c[i]=20=3D=20clone_obj(prop);=0A=20=20=20=20=20=20}=0A=20=20=20=20=
}=20else=20{=0A=20=20=20=20=20=20c[i]=20=3D=20prop;=0A=20=20=20=20}=0A=20=
=20}=0A=20=20return=20c;=0A}=0A=

--Apple-Mail=_BE26F175-03B8-4504-A71F-868C5564C622--
